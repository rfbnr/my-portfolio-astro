---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import ProjectDetailPage from "@/components/sections/ProjectDetailPage";
import { getProjects } from "@/lib/content";

// Generate static paths from content collection
export async function getStaticPaths() {
  const projects = await getCollection("projects");
  
  return projects.map((entry) => ({
    params: { slug: entry.id },
    props: { project: entry },
  }));
}

const { project } = Astro.props;
const projectData = {
  id: project.id,
  slug: project.id,
  ...project.data,
};

// Get related projects (other projects for sidebar)
const allProjects = await getProjects();
const relatedProjects = allProjects
  .filter((p) => p.id !== project.id)
  .slice(0, 3);
---

<Layout 
  title={`${projectData.title} | Case Study | Ridwan.dev`} 
  description={projectData.description}
>
  <ProjectDetailPage 
    client:visible 
    project={projectData}
    relatedProjects={relatedProjects}
  />
</Layout>
